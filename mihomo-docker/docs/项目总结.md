# Mihomo 裸核安装脚本项目总结

## 项目概述

基于原有的 Docker 版本安装脚本，新增了 **Mihomo 裸核安装脚本** (`mihomo-setup.sh`)，为用户提供了更轻量级、性能更优的 Mihomo 部署方案。

## 新增功能

### 🚀 mihomo-setup.sh - 裸核安装脚本

这是一个全新的安装脚本，直接在系统上安装和运行 Mihomo，无需 Docker 环境。

#### 核心特性

1. **一键安装**: 自动完成从下载到配置的全过程
2. **架构自适应**: 自动检测并下载适合的二进制文件（amd64/arm64/armv7）
3. **版本自动更新**: 自动获取最新版本进行安装
4. **完整的服务管理**: 基于 systemd 的服务管理
5. **网络配置自动化**: 自动开启 IP 转发，提供配置指导
6. **UI界面集成**: 自动安装 MetaCubeX 管理界面
7. **配置文件管理**: 智能配置文件处理和编辑功能
8. **状态监控**: 实时服务状态和日志查看
9. **安全卸载**: 完整清理所有相关文件

#### 菜单功能

```
1. 安装 Mihomo        - 完整安装流程
2. 启动服务          - 启动 Mihomo 服务
3. 停止服务          - 停止 Mihomo 服务
4. 重启服务          - 重启 Mihomo 服务
5. 查看状态          - 查看服务运行状态
6. 查看日志          - 实时查看服务日志
7. 编辑配置          - 编辑配置文件
8. 网络配置指导      - 显示网络配置方法
9. 更新 Mihomo       - 更新到最新版本
10. 测试安装         - 运行安装验证测试
11. 卸载 Mihomo      - 完全卸载 Mihomo
0. 退出              - 退出脚本
```

## 技术实现

### 安装流程

1. **环境检查**
   - Root 权限验证
   - 网络连接测试
   - 系统架构检测

2. **系统配置**
   - 软件包更新
   - 依赖安装（wget, curl, tar, net-tools）
   - IP 转发开启（IPv4/IPv6）

3. **Mihomo 安装**
   - 自动获取最新版本
   - 下载对应架构的二进制文件
   - 安装到 `/opt/mihomo/`

4. **UI 界面安装**
   - 下载 MetaCubeX UI
   - 解压到 `/etc/mihomo/ui/`

5. **配置文件处理**
   - 优先使用项目配置文件
   - 备选创建默认配置
   - 设置合适的文件权限

6. **服务配置**
   - 创建 systemd 服务文件
   - 设置开机自启动
   - 启动服务

### 文件结构

```
/opt/mihomo/
└── mihomo                    # 二进制文件

/etc/mihomo/
├── config.yaml              # 配置文件
└── ui/                       # Web UI 界面
    ├── index.html
    └── ...

/etc/systemd/system/
└── mihomo.service           # 系统服务文件
```

### 配置特性

- **端口配置**: 7890(混合), 7891(HTTP), 7892(SOCKS5), 9090(管理), 53(DNS)
- **TUN 模式**: 默认启用，支持透明代理
- **DNS 配置**: 国内外 DNS 分流，防污染
- **规则集**: 自动下载和更新分流规则
- **管理界面**: MetaCubeX UI，密码保护

## 辅助工具

### 🧪 test-mihomo.sh - 安装测试脚本

专门用于验证 Mihomo 安装是否成功的测试脚本。

#### 测试项目

1. **文件检查**: 二进制文件、配置文件、UI 文件
2. **服务检查**: systemd 服务状态、开机启动
3. **网络检查**: 端口监听、IP 转发
4. **功能检查**: 配置语法、管理界面连接

#### 测试结果

- 全面的测试报告
- 详细的失败诊断
- 访问信息展示
- 故障排除建议

## 文档完善

### 📚 使用说明文档

创建了详细的使用说明文档 `mihomo-setup使用说明.md`，包含：

- 完整的安装指导
- 功能详解
- 网络配置方法
- 故障排除指南
- 安全建议

### 📖 README 更新

更新了主 README 文件，添加了：

- 两种安装方式的对比
- 裸核版本的特性介绍
- 快速开始指南
- 系统要求说明

## 优势对比

### 裸核版本 vs Docker 版本

| 特性 | 裸核版本 | Docker 版本 |
|------|----------|-------------|
| **性能** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **资源占用** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **启动速度** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **管理复杂度** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **环境隔离** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **部署便利性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

## 使用建议

### 推荐使用裸核版本的场景

1. **性能敏感**: 需要最佳网络性能的场景
2. **资源受限**: VPS 资源有限的环境
3. **简单部署**: 希望快速部署的用户
4. **系统集成**: 需要与系统深度集成的场景

### 推荐使用 Docker 版本的场景

1. **环境隔离**: 需要严格环境隔离的场景
2. **容器编排**: 使用 K8s 等容器编排的环境
3. **多实例**: 需要运行多个 Mihomo 实例
4. **开发测试**: 开发和测试环境

## 总结

新增的裸核安装脚本为 Mihomo 项目提供了更加灵活的部署选择，特别适合追求性能和简洁性的用户。通过完善的脚本设计、详细的文档说明和全面的测试工具，确保用户能够轻松、安全地部署和管理 Mihomo 代理服务。

这个项目现在为不同需求的用户提供了最佳的解决方案，无论是喜欢容器化部署的用户，还是偏好原生系统运行的用户，都能找到适合自己的安装方式。 